print("Testis 3")

-- Konfigurasi
local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local PathWaveDetection = Player.PlayerGui.Top.Wave

-- Konfigurasi tambahan
local waitTimeTeleport = 1 -- Waktu tunggu setelah teleportasi sebelum summon pet
local petNameAfton = "Nightguard Afton" -- Nama pet Nightguard Afton
local petNameBallora = "Eclipse Ballora" -- Nama pet Eclipse Ballora
local stopWave = "Wave 2/15" -- Wave di mana loop akan berhenti
local stopLoop = false -- Status untuk menghentikan loop

-- Fungsi untuk menghitung posisi dengan offset
local function calculateAdjustedPosition(part1, part2, part3, part4, offset)
    local midpoint1 = (part1.Position + part2.Position) / 2
    local midpoint2 = (part3.Position + part4.Position) / 2
    return ((midpoint1 + midpoint2) / 2) + offset
end

-- Fungsi untuk teleport dan summon pet
local function teleportAndSummonPet(petName, offset)
    if stopLoop then return end

    local character = Player.Character or Player.CharacterAdded:Wait()

    -- Ambil bagian untuk koordinat
    local parts = {
        workspace.Map:WaitForChild("Paths"):WaitForChild("1"):WaitForChild("Start"),
        workspace.Map:WaitForChild("Paths"):WaitForChild("1"):WaitForChild("4"),
        workspace.Map:WaitForChild("Paths"):WaitForChild("2"):WaitForChild("1"),
        workspace.Map:WaitForChild("Deco"):WaitForChild("Electrical Box"):WaitForChild("Meshes/Electrical Box_Cube.001")
    }

    -- Hitung posisi yang disesuaikan
    local finalPosition = calculateAdjustedPosition(parts[1], parts[2], parts[3], parts[4], offset)

    -- Pindahkan karakter ke posisi yang dihitung
    character.HumanoidRootPart.CFrame = CFrame.new(finalPosition)

    -- Reset sebelum summon
    local argsReset = { [1] = "Reset" }
    game:GetService("ReplicatedStorage").Remotes.Misc.StopSettings:FireServer(unpack(argsReset))

    for i = 1, 68 do
        game:GetService("ReplicatedStorage").Remotes.Misc.StopSettings:FireServer()
    end

    -- Summon pet
    local humanoidRootPartCFrame = character.HumanoidRootPart.CFrame
    local argsSummon = { [1] = petName, [2] = humanoidRootPartCFrame }
    game:GetService("ReplicatedStorage").Remotes.Towers.SummonTower:FireServer(unpack(argsSummon))
end

-- Fungsi utama untuk memulai summon
local function startSummoning()
    -- Pertama, summon Eclipse Ballora di lokasi tertentu
    teleportAndSummonPet(petNameBallora, Vector3.new(-2, 0, -5)) -- Offset untuk Eclipse Ballora
    task.wait(waitTimeTeleport)

    -- Kedua, summon Nightguard Afton di lokasi tertentu
    teleportAndSummonPet(petNameAfton, Vector3.new(-2, 0, 4)) -- Offset untuk Nightguard Afton
end

-- Listener untuk mendeteksi perubahan teks di PathWaveDetection
PathWaveDetection:GetPropertyChangedSignal("Text"):Connect(function()
    local waveText = PathWaveDetection.Text

    -- Hentikan loop jika wave mencapai atau melebihi stopWave
    if waveText == stopWave then
        stopLoop = true
        print("Loop dihentikan karena mencapai " .. stopWave)
        return
    end

    -- Mulai summon saat wave dimulai
    if not stopLoop then
        startSummoning()
    end
end)

-- Tunggu sampai Map ter-load
local function waitForMap()
    print("Menunggu Map untuk ter-load...")
    workspace.ChildAdded:Wait()
    while not workspace:FindFirstChild("Map") do
        workspace.ChildAdded:Wait()
    end
    print("Map ter-load.")
end

-- Eksekusi script
waitForMap()
startSummoning()
